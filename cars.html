<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ø³ÙŠØ§Ø±Ø§Øª | Ø³ÙˆÙ‚ Pi</title>
    <link rel="stylesheet" href="assets/css/main.css"> <!-- Ø³Ù†Ù†Ø´Ø¦Ù‡ Ù„Ø§Ø­Ù‚Ø§Ù‹ -->
    <script src="https://sdk.minepi.com/pi-sdk.js"></script>
</head>
<body>
    <!-- Ø´Ø±ÙŠØ· Ø§Ù„ØªÙ†Ù‚Ù„ (Ø§Ù†Ø³Ø®Ù‡ Ù…Ù† index.html) -->
    <nav class="navbar"> ... </nav>

    <div class="container">
        <h1 class="section-title">ðŸš— Ø§Ù„Ø³ÙŠØ§Ø±Ø§Øª Ø§Ù„Ù…ØªØ§Ø­Ø©</h1>
        <div class="products-grid" id="carsGrid">
            <!-- Ù‡Ù†Ø§ Ø³ØªØ¸Ù‡Ø± Ø§Ù„Ø³ÙŠØ§Ø±Ø§Øª -->
        </div>
    </div>

    <!-- ØªØ°ÙŠÙŠÙ„ Ø§Ù„ØµÙØ­Ø© -->
    <footer class="footer"> ... </footer>

    <script>
        const API_URL = 'https://sheetdb.io/api/v1/xxxxxxxxxxxxxx'; // Ø¶Ø¹ Ø±Ø§Ø¨Ø· SheetDB Ù‡Ù†Ø§
        const BASE_PRICE = 7; // 1 Pi = 7 Ø¯ÙŠÙ†Ø§Ø±

        async function loadCars() {
            try {
                const response = await fetch(API_URL);
                const products = await response.json();
                const cars = products.filter(p => p.category === 'Ø³ÙŠØ§Ø±Ø§Øª');

                const grid = document.getElementById('carsGrid');
                grid.innerHTML = cars.map(car => {
                    const piPrice = (car.price / BASE_PRICE).toFixed(2);
                    return `
                        <div class="product-card">
                            <img src="images/${car.image}" alt="${car.name}" class="product-image">
                            <h3>${car.name}</h3>
                            <p>${car.description}</p>
                            <div class="product-price">${car.price} Ø¯.Ø£</div>
                            <span class="pi-price">${piPrice} Pi</span>
                            <button class="buy-button" onclick="buyCar(${car.id}, '${car.name}', ${car.price})">
                                Ø§Ø´ØªØ±ÙŠ Ø¨Ù€ Pi
                            </button>
                        </div>
                    `;
                }).join('');
            } catch (error) {
                console.error('Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø³ÙŠØ§Ø±Ø§Øª:', error);
            }
        }

        function buyCar(id, name, priceJOD) {
            const piAmount = (priceJOD / BASE_PRICE).toFixed(2);
            if (!confirm(`Ø´Ø±Ø§Ø¡ ${name} Ø¨Ù€ ${piAmount} PiØŸ`)) return;

            Pi.createPayment({
                amount: parseFloat(piAmount),
                memo: `Ø´Ø±Ø§Ø¡ ${name}`,
                metadata: { productId: id }
            }).then(payment => {
                alert('ØªÙ… Ø§Ù„Ø´Ø±Ø§Ø¡ Ø¨Ù†Ø¬Ø§Ø­!');
            }).catch(err => {
                alert('ÙØ´Ù„ Ø§Ù„Ø´Ø±Ø§Ø¡');
            });
        }

        document.addEventListener('DOMContentLoaded', () => {
            // ØªÙ‡ÙŠØ¦Ø© Pi SDK (Ø¥Ø°Ø§ Ù„Ù… ØªÙƒÙ† Ù…Ù‡ÙŠØ£Ø©)
            if (window.Pi) {
                Pi.init({ appId: 'souq-pi-test' });
            }
            loadCars();
        });
    </script>
</body>
</html>
